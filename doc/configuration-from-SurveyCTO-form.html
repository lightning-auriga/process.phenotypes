<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Configuration from a SurveyCTO Form Definition</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Configuration from a SurveyCTO Form Definition</h1>


<div id="TOC">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#parse.surveycto-semi-automated-configuration-of-a-surveycto-questionnaire"><code>parse.surveycto</code>: semi-automated configuration of a SurveyCTO questionnaire</a>
<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#example">Example</a></li>
</ul></li>
<li><a href="#expand.surveycto.config-adjust-an-existing-dataset-configuration-based-on-newer-data-export"><code>expand.surveycto.config</code>: adjust an existing dataset configuration based on newer data export</a>
<ul>
<li><a href="#use-case">Use Case</a></li>
<li><a href="#requirements-1">Requirements</a></li>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#example-1">Example</a></li>
</ul></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(process.phenotypes)</span></code></pre></div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The original use cases of this package involved manual configuration of unstructured datasets. This is still the most common use case, and we have provided <a href="manual-configuration.Rmd">a vignette covering manual dataset configuration</a> for that situation. However, in many cases a dataset already has a data definition or dictionary, and the challenge is converting that configuration to a format compatible with <code>process.phenotypes</code>.</p>
<p>If your dataset is derived from a <a href="https://www.surveycto.com/">SurveyCTO</a> questionnaire, we have provided a utility function, <code>process.phenotypes::parse.surveycto</code>, to facilitate the conversion of the SurveyCTO form definition into a barebones <code>process.phenotypes</code> dataset configuration and shared models specification. This vignette will walk through the process of converting a form definition, and furthermore showcase the situation when an existing SurveyCTO-derived configuration file needs to be expanded to adapt to additional collected data.</p>
</div>
<div id="parse.surveycto-semi-automated-configuration-of-a-surveycto-questionnaire" class="section level2">
<h2><code>parse.surveycto</code>: semi-automated configuration of a SurveyCTO questionnaire</h2>
<div id="requirements" class="section level3">
<h3>Requirements</h3>
<p>To use the automated SurveyCTO configuration tool, the following information is required:</p>
<ul>
<li>A SurveyCTO form definition spreadsheet (as xlsx). The form definition format is beyond the scope of this vignette; please see the <a href="https://docs.surveycto.com/02-designing-forms/01-core-concepts/01.intro.html">extensive SurveyCTO documentation</a> for further information. The conversion function requires:
<ul>
<li>the form sheet <code>survey</code>, expecting the first three columns <code>type</code>, <code>name</code>, and <code>label</code></li>
<li>the form sheet <code>choices</code>, expecting the first three columns <code>list_name</code>, <code>value</code>, and <code>label</code></li>
</ul></li>
<li>A data export from SurveyCTO. This can come from a variety of sources, though the following are required or suggested:
<ul>
<li>the data format should be <strong>wide format</strong> csv</li>
<li>the data should <em>almost certainly</em> have been exported while the corresponding form xlsx file was active
<ul>
<li>this is not <em>technically</em> required; but</li>
<li>discrepancies between form variants will cause SurveyCTO to take aggressive means to harmonize data in a single output format. If form changes are substantial enough, there can be actual incompatibilities between the form definition and data export that will manifest mysteriously in downstream analysis. One example is if a form definition somehow loses a categorical variable level that was in use earlier in the same data collection. SurveyCTO preserves the old level, but as it’s not present in the <code>choices</code> tab of the form definition, it will appear to be an unexpected categorical response.</li>
</ul></li>
<li>though data export from the SurveyCTO web interface is possible, it is generally much easier to use their API. API documentation is not publicly online at the time of this writing, but that information can be provided by your SurveyCTO representative.</li>
</ul></li>
<li>A tag for the dataset
<ul>
<li>this should be a short, alphabetical identifier for the dataset</li>
<li>because <code>parse.surveycto</code> tries to streamline most of the configuration process, it automatically names variables <code>{tag}#####</code>, with potential trailing underscores denoting repeat or multiple response variables</li>
<li>this variable format can be changed at will after the function is run, though note that the format should be preserved if you want to use the package’s utility function for repeat block expansion</li>
</ul></li>
<li>The desired name of the output dataset configuration file
<ul>
<li>this approximately corresponds to the SurveyCTO form definition tab <code>survey</code></li>
</ul></li>
<li>The desired name of the output shared model configuration file
<ul>
<li>this approximately corresponds to the SurveyCTO form definition tab <code>choices</code></li>
</ul></li>
<li>The name of the subject ID column in the SurveyCTO data export csv</li>
<li>The name of the subject age column in the SurveyCTO data export csv</li>
</ul>
</div>
<div id="example" class="section level3">
<h3>Example</h3>
<p>Consider the following example SurveyCTO configuration:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>surveycto.xlsx <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;examples&quot;</span>, <span class="st">&quot;parse_surveycto_example.xlsx&quot;</span>, <span class="at">package =</span> <span class="st">&quot;process.phenotypes&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>surveycto.csv <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;examples&quot;</span>, <span class="st">&quot;parse_surveycto_example.csv&quot;</span>, <span class="at">package =</span> <span class="st">&quot;process.phenotypes&quot;</span>)</span></code></pre></div>
<p>These input files contain tiny example information as follows:</p>
<pre><code>#&gt; ## SurveyCTO Survey Tab
#&gt;              type           name                 label
#&gt;             start      starttime                  &lt;NA&gt;
#&gt;               end        endtime                  &lt;NA&gt;
#&gt;          deviceid       deviceid                  &lt;NA&gt;
#&gt;      subscriberid   subscriberid                  &lt;NA&gt;
#&gt;         simserial          simid                  &lt;NA&gt;
#&gt;       phonenumber devicephonenum                  &lt;NA&gt;
#&gt;          username       username                  &lt;NA&gt;
#&gt;            caseid         caseid                  &lt;NA&gt;
#&gt;  select_one yesno         option do you want the thing
#&gt;      begin repeat           &lt;NA&gt;                  &lt;NA&gt;
#&gt;              text      subjectid      enter subject id
#&gt;        end repeat           &lt;NA&gt;                  &lt;NA&gt;
#&gt;           decimal     subjectage       how old are you
#&gt; 
#&gt; 
#&gt; ## SurveyCTO Choices Tab
#&gt;  list_name value label
#&gt;      yesno     1   Yes
#&gt;      yesno     0    No
#&gt; 
#&gt; 
#&gt; ## SurveyCTO Export Data
#&gt;  SubmissionDate starttime endtime deviceid subscriberid simid devicephonenum
#&gt;            2022         1       2        3            4     5              6
#&gt;            2022         8       7        6            5     4              3
#&gt;  username caseid option subjectid_1 subjectage formdef_version
#&gt;         7      8      1           A         20             100
#&gt;         2      1      0           B         30             100</code></pre>
<p>To use the <code>parse.surveycto</code> helper function, provide this information, along with a user-specified character tag for use as a prefix in the output harmonized variable names; the desired name of the output dataset configuration file; and the desired name of the output shared models configuration file. You must also specify the column names corresponding to the subject ID and subject age variables in the dataset. These variables are not required for the helper function itself, but are required for the primary run of <code>process.phenotypes::create.phenotype.report</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>output.dataset.yaml <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="st">&quot;parse.surveycto.vignette.dataset&quot;</span>, <span class="at">fileext =</span> <span class="st">&quot;.yaml&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>output.shared.models <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="st">&quot;parse.surveycto.vignette.shared.models&quot;</span>, <span class="at">fileext =</span> <span class="st">&quot;.yaml&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>process.phenotypes<span class="sc">::</span><span class="fu">parse.surveycto</span>(surveycto.xlsx,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  surveycto.csv,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;HW&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  output.dataset.yaml,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  output.shared.models,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject.id.name =</span> <span class="st">&quot;subjectid_1&quot;</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">age.name =</span> <span class="st">&quot;subjectage&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Please note the most important point of this helper function run: the output configuration files are considered a <em>starting point</em> for your configuration, not the endpoint. The files will contain entries for each variable in the dataset, and all of the shared models specified in the form definition <code>choices</code> tab (regardless of whether they’re actually envoked in the current survey). Each variable entry will have <code>type</code> or <code>shared_model</code> specifications according to sane defaults, along with certain additional settings (<code>subject_id: yes</code> and <code>subject_age: yes</code> set for the appropriate variables; reporting content from <code>create.phenotype.report</code> suppressed for freetext variables, etc.). However, no dependencies are encoded; obviously no derived variables are configured; and just in general, some of the baseline guesses may not be exactly suited to your needs.</p>
<p>For the above example, the dataset configuration end up as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tag</span><span class="kw">:</span><span class="at"> HW</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">globals</span><span class="kw">:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">min_age_for_inclusion</span><span class="kw">:</span><span class="at"> </span><span class="fl">18.0</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">max_invalid_datatypes_per_subject</span><span class="kw">:</span><span class="at"> </span><span class="fl">10.0</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">consent_inclusion_file</span><span class="kw">:</span><span class="at"> </span><span class="ch">~</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">consent_exclusion_file</span><span class="kw">:</span><span class="at"> </span><span class="ch">~</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">variables</span><span class="kw">:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00001</span><span class="kw">:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> SubmissionDate</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> SubmissionDate</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00002</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> starttime</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00003</span><span class="kw">:</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> endtime</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00004</span><span class="kw">:</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> deviceid</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00005</span><span class="kw">:</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> subscriberid</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00006</span><span class="kw">:</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> simid</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00007</span><span class="kw">:</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> devicephonenum</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00008</span><span class="kw">:</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> username</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00009</span><span class="kw">:</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> caseid</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> .na</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00010</span><span class="kw">:</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> option</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">shared_model</span><span class="kw">:</span><span class="at"> yesno</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> do you want the thing</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00011_1</span><span class="kw">:</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> subjectid_1</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> enter subject id, repeat observation 1</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">subject_id</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00012</span><span class="kw">:</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> subjectage</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> numeric</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> how old are you</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">subject_age</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00013</span><span class="kw">:</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> formdef_version</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> formdef_version</span></span></code></pre></div>
<p>You’ll note that this contains variables <code>SubmissionDate</code> and <code>formdef_version</code> that were not actually configured in the form definition. SurveyCTO injects an assortment of metadata variables into its output, sometimes rather unpredictably. <code>parse.surveycto</code> will intelligently configure just the variables that are actually present in the current data export, setting them as string variables with suppressed reporting.</p>
<p>Once you have this barebones configuration file, you can either directly edit the configuration blocks if you know what kinds of changes you want (specifically, you should include consent inclusion and exclusion files as appropriate; null entries for those fields are accepted but not preferred). If you’re not sure where to start, you can also consider running <code>create.phenotype.report</code> to emit a basic summary HTML report that can be used to determine what configuration refinements are needed.</p>
<p>The shared models configuration file looks like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">models</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">yesno</span><span class="kw">:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> categorical</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">levels</span><span class="kw">:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">lvl1</span><span class="kw">:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;Yes&#39;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">alternate_patterns</span><span class="kw">:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;1&#39;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">lvl2</span><span class="kw">:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;No&#39;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">alternate_patterns</span><span class="kw">:</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;0&#39;</span></span></code></pre></div>
<p>All models from the form definition <code>choices</code> tab are included in the shared models file, regardless of whether they’re invoked with <code>select_one</code> or <code>select_multiple</code> in the <code>survey</code> tab. If you have multiple questionnaires that use the same <code>choices</code> information, it is preferable to create a single shared models file to use with all datasets, such that the output processed variables are much more likely to be intrinsically comparable to one another.</p>
</div>
</div>
<div id="expand.surveycto.config-adjust-an-existing-dataset-configuration-based-on-newer-data-export" class="section level2">
<h2><code>expand.surveycto.config</code>: adjust an existing dataset configuration based on newer data export</h2>
<div id="use-case" class="section level3">
<h3>Use Case</h3>
<p>One of the strange idiosyncrasies of SurveyCTO datasets is that the output variable set can expand in later data exports. This is <em>almost</em> always due to the use of variables tagged as part of a <strong>repeat</strong> block, annotated between <code>begin repeat</code> and <code>end repeat</code> statements. The following behaviors have been observed in datasets to date:</p>
<ul>
<li>variables in an optional repeat block that have <em>no</em> responses will be missing from the output data entirely</li>
<li>variables with <code>N</code> entries will have <code>N</code> structured output variables. Consider the following example SurveyCTO form definition segment:</li>
</ul>
<pre><code>#&gt;          type name          label
#&gt;  begin repeat &lt;NA&gt;           &lt;NA&gt;
#&gt;          text var1   enter a word
#&gt;       decimal var2 enter a number
#&gt;    end repeat &lt;NA&gt;           &lt;NA&gt;</code></pre>
<p>The corresponding export data from SurveyCTO might look as follows:</p>
<pre><code>#&gt;  var1_1 var2_1 var1_2 var2_2 var1_3 var2_3
#&gt;   entry    1.1  entry    3.3  entry    5.5
#&gt;   entry    2.2  entry    4.4  entry    6.6</code></pre>
<ul>
<li><p>note that the blocks are repeated, in order, as:</p>
<ul>
<li>variable 1, repeat observation 1;</li>
<li>variable 2, repeat observation 1;</li>
<li>variable 1, repeat observation 2;</li>
<li>variable 2, repeat observation 2;</li>
<li>variable 1, repeat observation 3;</li>
<li>variable 2, repeat observation 3</li>
</ul></li>
<li><p>the above dataset will continue to expand as the <em>maximum number of responses per-subject</em> expands across the entire dataset. So perhaps the month after you’ve configured the dataset the first time, you export the data again, and now you suddenly see an additional 6 repeat collections per variable. This poses some challenges, because you could just run <code>parse.surveycto</code> again, but in that case you’ll lose any customization you’ve added to the original configuration file.</p></li>
</ul>
</div>
<div id="requirements-1" class="section level3">
<h3>Requirements</h3>
<p>To use <code>expand.surveycto.config</code> to handle repeat blocks in your new data export, the following information is required:</p>
<ul>
<li>the current dataset configuration file for your data</li>
<li>the desired name of the new output dataset yaml</li>
<li>the current (probably but not necessarily wider) csv data export from SurveyCTO</li>
<li>the current SurveyCTO form definition xlsx file; this can be same as before or updated, as appropriate</li>
</ul>
</div>
<div id="limitations" class="section level3">
<h3>Limitations</h3>
<p>It is essential to note here: you cannot use this utility function if you alter the variable aliases (e.g. <code>HW00001</code>, <code>HW00002</code>, etc.) in the original dataset configuration. That structured format is required for the function’s ability to extend configured blocks.</p>
<p>This function extends repeat blocks. It cannot introduce entirely new variables that are, for example, injected into new data exports based on modified form definitions. For that kind of variable, manual reconfiguration (or a rerun of <code>parse.surveycto</code> from scratch) is required.</p>
<p>Note that the shared models configuration file is not touched by this process at all.</p>
</div>
<div id="example-1" class="section level3">
<h3>Example</h3>
<p>We’ll use the same form definition as above. This time, we’ll use an example dataset that happens to have additional repeat observations for the <code>subjectid</code> base variable.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>surveycto.xlsx <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;examples&quot;</span>, <span class="st">&quot;parse_surveycto_example.xlsx&quot;</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">package =</span> <span class="st">&quot;process.phenotypes&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>surveycto.csv.expanded <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;examples&quot;</span>, <span class="st">&quot;parse_surveycto_example_expanded.csv&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">package =</span> <span class="st">&quot;process.phenotypes&quot;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; #### SurveyCTO Export Data (Expanded)
#&gt;  SubmissionDate starttime endtime deviceid subscriberid simid devicephonenum
#&gt;            2022         1       2        3            4     5              6
#&gt;            2022         8       7        6            5     4              3
#&gt;  username caseid option subjectid_1 subjectid_2 subjectage formdef_version
#&gt;         7      8      1           A           C         20             100
#&gt;         2      1      0           B           D         30             100</code></pre>
<p>With this information, you can run <code>expand.surveycto.config</code> as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## the input yaml for this run is the output from the prior run</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>input.existing.dataset.yaml <span class="ot">&lt;-</span> output.dataset.yaml</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>output.dataset.expanded.yaml <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="st">&quot;parse.surveycto.expanded.dataset&quot;</span>, <span class="at">fileext =</span> <span class="st">&quot;.yaml&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">## if you&#39;re providing csv input here, you need to override the delimiter in this function</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>process.phenotypes<span class="sc">::</span><span class="fu">expand.surveycto.config</span>(input.existing.dataset.yaml,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  output.dataset.expanded.yaml,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  surveycto.csv.expanded,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  surveycto.xlsx,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>This expanded configuration looks as follows (just showing the relevant changed portion):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00010</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> option</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">shared_model</span><span class="kw">:</span><span class="at"> yesno</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> do you want the thing</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00011_1</span><span class="kw">:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> subjectid_1</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> enter subject id, repeat observation 1</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">subject_id</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00011_2</span><span class="kw">:</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> subjectid_2</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> enter subject id, repeat observation 2</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">subject_id</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00012</span><span class="kw">:</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> subjectage</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> numeric</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> how old are you</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">subject_age</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">HW00013</span><span class="kw">:</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> formdef_version</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">suppress_reporting</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">canonical_name</span><span class="kw">:</span><span class="at"> formdef_version</span></span></code></pre></div>
<p>In theory, this output dataset yaml can now be combined with the existing shared models yaml to run your dataset through <code>create.phenotype.report</code>.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
